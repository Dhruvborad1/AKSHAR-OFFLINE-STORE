<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AKSHAR OFFLINE STORE | Inventory & Business Management</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.13/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root {
            --primary: #4f46e5;
            --primary-dark: #3730a3;
            --secondary: #7c3aed;
            --accent: #0ea5e9;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --light: #f8fafc;
            --dark: #1e293b;
            --gray: #64748b;
            --light-gray: #f1f5f9;
            --card-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --sidebar-width: 260px;
            --header-height: 70px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f5f7fb;
            color: var(--dark);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Sidebar Styles */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: var(--sidebar-width);
            height: 100vh;
            background: linear-gradient(180deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 20px 0;
            z-index: 100;
            box-shadow: 5px 0 15px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 0 20px 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
            font-weight: 700;
        }

        .logo i {
            font-size: 1.8rem;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 10px;
        }

        .nav-menu {
            list-style: none;
            padding: 0 15px;
        }

        .nav-item {
            margin-bottom: 8px;
            border-radius: 10px;
            overflow: hidden;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px 20px;
            color: rgba(255, 255, 255, 0.85);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
        }

        .nav-link:hover,
        .nav-link.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transform: translateX(5px);
        }

        .nav-link i {
            width: 20px;
            text-align: center;
            font-size: 1.2rem;
        }

        .nav-link.active {
            background: rgba(255, 255, 255, 0.15);
            border-left: 4px solid var(--accent);
        }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            padding: 20px;
            min-height: 100vh;
            transition: var(--transition);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e2e8f0;
        }

        .page-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .search-box {
            position: relative;
            width: 300px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 20px 12px 45px;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            font-size: 0.95rem;
            background-color: white;
            transition: var(--transition);
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.15);
        }

        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            cursor: pointer;
            transition: var(--transition);
        }

        .user-profile:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        /* Mobile Menu Button */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--dark);
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
            transition: var(--transition);
        }

        .mobile-menu-btn:hover {
            background: var(--light-gray);
        }

        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
                width: 280px;
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .mobile-menu-btn {
                display: block;
            }

            .search-box {
                width: 200px;
            }
        }

        @media (min-width: 993px) {
            .mobile-menu-btn {
                display: none !important;
            }
        }

        @media (max-width: 768px) {
            .search-box {
                width: 100%;
                order: 3;
                margin-top: 15px;
            }

            .header {
                flex-wrap: wrap;
            }

            .user-menu {
                width: 100%;
                justify-content: space-between;
                flex-wrap: wrap;
            }
        }

        /* Dashboard */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            border-left: 5px solid var(--primary);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }

        .stat-card:nth-child(2) {
            border-left-color: var(--secondary);
        }

        .stat-card:nth-child(3) {
            border-left-color: var(--success);
        }

        .stat-card:nth-child(4) {
            border-left-color: var(--warning);
        }

        .stat-card:nth-child(5) {
            border-left-color: var(--accent);
        }

        .stat-card:nth-child(6) {
            border-left-color: var(--danger);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: white;
            background: var(--primary);
        }

        .stat-card:nth-child(2) .stat-icon {
            background: var(--secondary);
        }

        .stat-card:nth-child(3) .stat-icon {
            background: var(--success);
        }

        .stat-card:nth-child(4) .stat-icon {
            background: var(--warning);
        }

        .stat-card:nth-child(5) .stat-icon {
            background: var(--accent);
        }

        .stat-card:nth-child(6) .stat-icon {
            background: var(--danger);
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--gray);
            font-size: 0.95rem;
        }

        .stat-change {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        .positive {
            color: var(--success);
        }

        .negative {
            color: var(--danger);
        }

        /* Content Sections */
        .content-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--card-shadow);
            margin-bottom: 30px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn {
            padding: 12px 24px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
        }

        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 7px 14px rgba(79, 70, 229, 0.2);
        }

        .btn-secondary {
            background: var(--light-gray);
            color: var(--dark);
        }

        .btn-secondary:hover {
            background: #e2e8f0;
        }

        .btn-success {
            background: var(--success);
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: var(--danger);
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-warning {
            background: var(--warning);
        }

        .btn-warning:hover {
            background: #d97706;
        }

        /* Inventory Table */
        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .data-table thead {
            background: var(--light-gray);
        }

        .data-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: var(--dark);
            border-bottom: 2px solid #e2e8f0;
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
        }

        .data-table tbody tr:hover {
            background: #f8fafc;
        }

        .data-table .actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            width: 35px;
            height: 35px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            color: white;
        }

        .edit-btn {
            background: var(--warning);
        }

        .delete-btn {
            background: var(--danger);
        }

        .view-btn {
            background: var(--primary);
        }

        .action-btn:hover {
            transform: translateY(-2px);
        }

        /* Forms */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 14px;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: var(--transition);
            background: white;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.15);
        }

        /* Diary */
        .diary-entry {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-left: 5px solid var(--accent);
            transition: var(--transition);
        }

        .diary-entry:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
        }

        .diary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .diary-date {
            font-weight: 600;
            color: var(--primary);
            font-size: 1.1rem;
        }

        .diary-content {
            color: var(--dark);
            line-height: 1.7;
        }

        .diary-tags {
            display: flex;
            gap: 8px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .tag {
            background: var(--light-gray);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            color: var(--dark);
        }

        /* Chart Container */
        .chart-container {
            height: 300px;
            margin-top: 20px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 20px 25px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--dark);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
            transition: var(--transition);
        }

        .close-modal:hover {
            color: var(--danger);
        }

        .modal-body {
            padding: 25px;
        }

        /* Image Grid */
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .image-item {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            height: 120px;
        }

        .image-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition);
        }

        .image-item:hover img {
            transform: scale(1.05);
        }

        .remove-image {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: var(--danger);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.8rem;
        }

        /* Image Gallery Modal */
        .image-gallery-modal .modal-content {
            max-width: 900px;
        }

        .gallery-container {
            display: flex;
            flex-direction: column;
            height: 70vh;
        }

        .main-gallery-image {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8fafc;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .main-gallery-image img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .gallery-thumbnails {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 10px 0;
        }

        .gallery-thumb {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: var(--transition);
        }

        .gallery-thumb.active {
            border-color: var(--primary);
        }

        .gallery-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Page Transitions */
        .page {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page.active {
            display: block;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        /* Currency */
        .currency {
            font-family: 'Arial', sans-serif;
        }

        .currency::before {
            content: "₹";
        }

        /* Toggle Switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: var(--primary);
        }

        input:checked+.slider:before {
            transform: translateX(26px);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.3;
            display: block;
        }

        /* Filter Box */
        #filterSection {
            background: var(--light-gray);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            transition: var(--transition);
        }

        /* Responsive Improvements */
        @media (max-width: 768px) {
            .stats-cards {
                grid-template-columns: repeat(auto-fill, minmax(100%, 1fr));
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .section-header .btn {
                align-self: stretch;
            }

            .modal-content {
                max-height: 95vh;
            }

            .gallery-container {
                height: 60vh;
            }
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Profile Modal */
        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2.5rem;
            font-weight: 600;
            margin: 0 auto 20px;
        }

        /* Loading Spinner */
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <!-- Sidebar Navigation -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i class="fas fa-store"></i>
                <span>AKSHAR OFFLINE STORE</span>
            </div>
            <p style="font-size: 0.85rem; margin-top: 8px; opacity: 0.8;">Business Management Suite</p>
        </div>

        <ul class="nav-menu">
            <li class="nav-item">
                <a href="#dashboard" class="nav-link active" data-page="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#inventory" class="nav-link" data-page="inventory">
                    <i class="fas fa-boxes"></i>
                    <span>Inventory</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#add-item" class="nav-link" data-page="add-item">
                    <i class="fas fa-plus-circle"></i>
                    <span>Add New Item</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#suppliers" class="nav-link" data-page="suppliers">
                    <i class="fas fa-truck"></i>
                    <span>Suppliers</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#sales" class="nav-link" data-page="sales">
                    <i class="fas fa-chart-line"></i>
                    <span>Sales Analytics</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#diary" class="nav-link" data-page="diary">
                    <i class="fas fa-book"></i>
                    <span>Business Diary</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#reports" class="nav-link" data-page="reports">
                    <i class="fas fa-file-alt"></i>
                    <span>Reports</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#settings" class="nav-link" data-page="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
            </li>
        </ul>

        <div style="padding: 20px; margin-top: auto; border-top: 1px solid rgba(255, 255, 255, 0.1);">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <div>
                    <div style="font-weight: 600;">Shop Status</div>
                    <div style="font-size: 0.85rem; opacity: 0.8;">Open • 9:00 AM - 9:00 PM</div>
                </div>
                <label class="switch">
                    <input type="checkbox" id="shopStatusToggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="header">
            <div style="display: flex; align-items: center; gap: 15px;">
                <button class="mobile-menu-btn" id="mobileMenuBtn">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 class="page-title">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard Overview</span>
                </h1>
            </div>

            <div class="user-menu">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="globalSearch" placeholder="Search inventory, sales, diary...">
                </div>

                <div class="user-profile" id="userProfileBtn">
                    <div class="user-avatar" id="userAvatar">RS</div>
                    <div>
                        <div style="font-weight: 600;" id="userName">Rohan Sharma</div>
                        <div style="font-size: 0.85rem; color: var(--gray);">Shop Owner</div>
                    </div>
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>
        </header>

        <!-- Dashboard Page -->
        <section id="dashboard" class="page active">
            <!-- Stats Cards -->
            <div class="stats-cards">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-boxes"></i>
                    </div>
                    <div class="stat-value" id="totalItems">0</div>
                    <div class="stat-label">Total Items in Stock</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span id="itemsChange">0% from last month</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-rupee-sign"></i>
                    </div>
                    <div class="stat-value currency" id="inventoryValue">0</div>
                    <div class="stat-label">Total Inventory Value</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span id="valueChange">0% from last month</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <div class="stat-value currency" id="monthlySales">0</div>
                    <div class="stat-label">Monthly Sales</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span id="salesChange">0% from last month</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-percentage"></i>
                    </div>
                    <div class="stat-value" id="profitMargin">0%</div>
                    <div class="stat-label">Average Profit Margin</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span id="marginChange">0% from last month</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-truck"></i>
                    </div>
                    <div class="stat-value" id="suppliersCount">0</div>
                    <div class="stat-label">Active Suppliers</div>
                    <div class="stat-change negative">
                        <i class="fas fa-arrow-down"></i>
                        <span id="suppliersChange">0 from last month</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-value" id="lowStockItems">0</div>
                    <div class="stat-label">Low Stock Items</div>
                    <div class="stat-change negative">
                        <i class="fas fa-arrow-up"></i>
                        <span id="lowStockChange">0 items need attention</span>
                    </div>
                </div>
            </div>

            <!-- Recent Activity and Low Stock -->
            <div class="content-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-history"></i>
                        Recent Activity
                    </h2>
                    <button class="btn btn-secondary" onclick="loadRecentActivity()">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                </div>

                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Item Name</th>
                                <th>Category</th>
                                <th>Stock</th>
                                <th>Last Updated</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="recentActivityTable">
                            <!-- Data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="content-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-bolt"></i>
                        Quick Actions
                    </h2>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">
                    <button class="btn" onclick="showPage('add-item')">
                        <i class="fas fa-plus"></i>
                        Add New Item
                    </button>
                    <button class="btn btn-success" onclick="recordSale()">
                        <i class="fas fa-rupee-sign"></i>
                        Record Sale
                    </button>
                    <button class="btn btn-warning" onclick="showPage('suppliers')">
                        <i class="fas fa-truck"></i>
                        Order Stock
                    </button>
                    <button class="btn btn-secondary" onclick="showPage('diary')">
                        <i class="fas fa-book"></i>
                        Add Diary Entry
                    </button>
                </div>
            </div>
        </section>

        <!-- Inventory Page -->
        <section id="inventory" class="page">
            <div class="content-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-boxes"></i>
                        Inventory Management
                    </h2>
                    <div>
                        <button class="btn btn-secondary" id="filterToggle">
                            <i class="fas fa-filter"></i>
                            Filter
                        </button>
                        <button class="btn" onclick="showPage('add-item')">
                            <i class="fas fa-plus"></i>
                            Add New Item
                        </button>
                    </div>
                </div>

                <!-- Filter Section -->
                <div id="filterSection" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Search by Name</label>
                            <input type="text" id="filterName" class="form-control" placeholder="Enter item name...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Category</label>
                            <select id="filterCategory" class="form-control">
                                <option value="">All Categories</option>
                                <option value="electronics">Electronics</option>
                                <option value="clothing">Clothing</option>
                                <option value="home">Home & Kitchen</option>
                                <option value="groceries">Groceries</option>
                                <option value="beauty">Beauty & Health</option>
                                <option value="sports">Sports & Outdoors</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Stock Status</label>
                            <select id="filterStock" class="form-control">
                                <option value="">All</option>
                                <option value="low">Low Stock</option>
                                <option value="out">Out of Stock</option>
                                <option value="good">In Stock</option>
                            </select>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn" onclick="applyFilters()">
                            <i class="fas fa-check"></i>
                            Apply Filters
                        </button>
                        <button class="btn btn-secondary" onclick="resetFilters()">
                            <i class="fas fa-times"></i>
                            Reset Filters
                        </button>
                    </div>
                </div>

                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Item Name</th>
                                <th>Category</th>
                                <th>Purchase Price</th>
                                <th>Selling Price</th>
                                <th>Stock</th>
                                <th>Value</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryTable">
                            <!-- Data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Add Item Page -->
        <section id="add-item" class="page">
            <div class="content-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-plus-circle"></i>
                        Add New Item to Inventory
                    </h2>
                </div>

                <form id="itemForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Item Name *</label>
                            <input type="text" id="itemName" class="form-control" placeholder="Enter item name"
                                required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Category *</label>
                            <select id="itemCategory" class="form-control" required>
                                <option value="">Select Category</option>
                                <option value="electronics">Electronics</option>
                                <option value="clothing">Clothing</option>
                                <option value="home">Home & Kitchen</option>
                                <option value="groceries">Groceries</option>
                                <option value="beauty">Beauty & Health</option>
                                <option value="sports">Sports & Outdoors</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Purchase Price (₹) *</label>
                            <input type="number" id="purchasePrice" class="form-control" placeholder="0.00" step="0.01"
                                min="0" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Selling Price (₹) *</label>
                            <input type="number" id="sellingPrice" class="form-control" placeholder="0.00" step="0.01"
                                min="0" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Quantity in Stock *</label>
                            <input type="number" id="itemQuantity" class="form-control" placeholder="0" min="0"
                                required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea id="itemDescription" class="form-control" rows="3"
                            placeholder="Enter item description..."></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Supplier</label>
                        <select id="itemSupplier" class="form-control">
                            <option value="">Select Supplier</option>
                            <!-- Suppliers will be populated dynamically -->
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Item Photos (Up to 5)</label>
                        <div style="border: 2px dashed #ccc; border-radius: 10px; padding: 30px; text-align: center; cursor: pointer;"
                            id="imageUploadArea">
                            <i class="fas fa-cloud-upload-alt"
                                style="font-size: 3rem; color: var(--primary); margin-bottom: 15px;"></i>
                            <div>Click to upload photos or drag and drop</div>
                            <div style="font-size: 0.9rem; color: var(--gray); margin-top: 5px;">JPEG, PNG or JPG (Max 5
                                images)</div>
                        </div>
                        <input type="file" id="imageInput" accept="image/*" multiple style="display: none;">
                        <div class="image-grid" id="imagePreview"></div>
                    </div>

                    <div style="display: flex; gap: 15px; margin-top: 30px;">
                        <button type="submit" class="btn">
                            <i class="fas fa-save"></i>
                            Save Item
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="resetItemForm()">
                            <i class="fas fa-redo"></i>
                            Reset Form
                        </button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Suppliers Page -->
        <section id="suppliers" class="page">
            <div class="content-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-truck"></i>
                        Supplier Management
                    </h2>
                    <button class="btn" onclick="openSupplierModal()">
                        <i class="fas fa-plus"></i>
                        Add New Supplier
                    </button>
                </div>

                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Supplier Name</th>
                                <th>Contact Person</th>
                                <th>Phone</th>
                                <th>Email</th>
                                <th>Items Supplied</th>
                                <th>Last Order</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="suppliersTable">
                            <!-- Data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Sales Analytics Page -->
        <section id="sales" class="page">
            <div class="content-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-chart-line"></i>
                        Sales Analytics
                    </h2>
                    <div>
                        <select id="salesPeriod" class="form-control"
                            style="width: auto; display: inline-block; margin-right: 10px;">
                            <option value="week">This Week</option>
                            <option value="month">This Month</option>
                            <option value="quarter">This Quarter</option>
                            <option value="year">This Year</option>
                        </select>
                        <button class="btn btn-success" onclick="recordSale()">
                            <i class="fas fa-plus"></i>
                            Record Sale
                        </button>
                    </div>
                </div>

                <div class="stats-cards">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-rupee-sign"></i>
                        </div>
                        <div class="stat-value currency" id="totalSales">0</div>
                        <div class="stat-label">Total Sales</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="stat-value" id="totalTransactions">0</div>
                        <div class="stat-label">Transactions</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-percentage"></i>
                        </div>
                        <div class="stat-value currency" id="avgTransaction">0</div>
                        <div class="stat-label">Avg. Transaction</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-chart-pie"></i>
                        </div>
                        <div class="stat-value" id="topCategory">-</div>
                        <div class="stat-label">Top Category</div>
                    </div>
                </div>

                <div
                    style="background: white; border-radius: 15px; padding: 25px; margin-top: 30px; box-shadow: var(--card-shadow);">
                    <h3 style="margin-bottom: 20px;">Sales Chart</h3>
                    <div class="chart-container">
                        <canvas id="salesChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Business Diary Page -->
        <section id="diary" class="page">
            <div class="content-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-book"></i>
                        Business Diary
                    </h2>
                    <button class="btn" onclick="openDiaryModal()">
                        <i class="fas fa-plus"></i>
                        New Entry
                    </button>
                </div>

                <div class="form-group">
                    <div class="search-box" style="width: 100%;">
                        <i class="fas fa-search"></i>
                        <input type="text" id="diarySearch" placeholder="Search diary entries...">
                    </div>
                </div>

                <div id="diaryEntries">
                    <!-- Diary entries will be populated by JavaScript -->
                </div>
            </div>
        </section>

        <!-- Reports Page -->
        <section id="reports" class="page">
            <div class="content-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-file-alt"></i>
                        Reports & Analytics
                    </h2>
                    <div>
                        <button class="btn btn-secondary" onclick="downloadReportPDF()">
                            <i class="fas fa-download"></i>
                            Export PDF
                        </button>
                        <button class="btn" onclick="printReport()">
                            <i class="fas fa-print"></i>
                            Print Report
                        </button>
                    </div>
                </div>

                <div class="stats-cards">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-file-invoice"></i>
                        </div>
                        <div class="stat-value">Inventory Report</div>
                        <div class="stat-label">Complete stock analysis</div>
                        <button class="btn btn-secondary" style="margin-top: 15px; padding: 8px 15px; width: 100%;"
                            onclick="generateReport('inventory')">
                            Generate
                        </button>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-chart-bar"></i>
                        </div>
                        <div class="stat-value">Sales Report</div>
                        <div class="stat-label">Monthly sales performance</div>
                        <button class="btn btn-secondary" style="margin-top: 15px; padding: 8px 15px; width: 100%;"
                            onclick="generateReport('sales')">
                            Generate
                        </button>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-value">Supplier Report</div>
                        <div class="stat-label">Supplier performance analysis</div>
                        <button class="btn btn-secondary" style="margin-top: 15px; padding: 8px 15px; width: 100%;"
                            onclick="generateReport('supplier')">
                            Generate
                        </button>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-value">Low Stock Alert</div>
                        <div class="stat-label">Items needing reorder</div>
                        <button class="btn btn-secondary" style="margin-top: 15px; padding: 8px 15px; width: 100%;"
                            onclick="generateReport('lowstock')">
                            Generate
                        </button>
                    </div>
                </div>

                <div
                    style="background: white; border-radius: 15px; padding: 25px; margin-top: 30px; box-shadow: var(--card-shadow);">
                    <h3 style="margin-bottom: 20px;">Report Preview</h3>
                    <div id="reportPreview" style="min-height: 300px; overflow: auto;">
                        <div class="empty-state">
                            <i class="fas fa-file-alt"></i>
                            <div>Select a report to generate preview</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Settings Page -->
        <section id="settings" class="page">
            <div class="content-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-cog"></i>
                        Settings
                    </h2>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Shop Name</label>
                        <input type="text" id="shopName" class="form-control" value="Rohan's Super Shop">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Currency</label>
                        <select id="currency" class="form-control">
                            <option selected>Indian Rupee (₹)</option>
                            <option>US Dollar ($)</option>
                            <option>Euro (€)</option>
                            <option>Pound (£)</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Low Stock Threshold</label>
                        <input type="number" id="lowStockThreshold" class="form-control" value="10">
                        <div style="font-size: 0.85rem; color: var(--gray); margin-top: 5px;">Alert when item quantity
                            falls below this number</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tax Percentage (%)</label>
                        <input type="number" id="taxPercentage" class="form-control" value="18" min="0" max="100"
                            step="0.01">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Shop Address</label>
                    <textarea id="shopAddress" class="form-control"
                        rows="3">123 Main Street, Mumbai, Maharashtra 400001</textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Contact Information</label>
                    <div class="form-row">
                        <div class="form-group">
                            <input type="text" id="shopPhone" class="form-control" value="+91 98765 43210"
                                placeholder="Phone Number">
                        </div>
                        <div class="form-group">
                            <input type="email" id="shopEmail" class="form-control" value="contact@rohansshop.com"
                                placeholder="Email Address">
                        </div>
                    </div>
                </div>

                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e2e8f0;">
                    <button class="btn btn-success" onclick="saveSettings()">
                        <i class="fas fa-save"></i>
                        Save Settings
                    </button>
                    <button class="btn btn-secondary" onclick="resetSettings()">
                        <i class="fas fa-redo"></i>
                        Reset to Default
                    </button>
                    <button class="btn btn-danger" onclick="confirmClearData()" style="float: right;">
                        <i class="fas fa-trash"></i>
                        Clear All Data
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- Supplier Modal -->
    <div class="modal" id="supplierModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add New Supplier</h3>
                <button class="close-modal" onclick="closeSupplierModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="supplierForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Supplier Name *</label>
                            <input type="text" id="supplierName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Contact Person *</label>
                            <input type="text" id="supplierContact" class="form-control" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Phone Number *</label>
                            <input type="tel" id="supplierPhone" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email Address</label>
                            <input type="email" id="supplierEmail" class="form-control">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Address</label>
                        <textarea id="supplierAddress" class="form-control" rows="2"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Items Supplied (Select multiple)</label>
                        <select id="supplierItems" class="form-control" multiple style="height: 100px;">
                            <option value="electronics">Electronics</option>
                            <option value="clothing">Clothing</option>
                            <option value="home">Home & Kitchen</option>
                            <option value="groceries">Groceries</option>
                            <option value="beauty">Beauty & Health</option>
                            <option value="sports">Sports & Outdoors</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        <button type="submit" class="btn">
                            <i class="fas fa-save"></i>
                            Save Supplier
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="closeSupplierModal()">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Diary Modal -->
    <div class="modal" id="diaryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">New Diary Entry</h3>
                <button class="close-modal" onclick="closeDiaryModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="diaryForm">
                    <div class="form-group">
                        <label class="form-label">Title *</label>
                        <input type="text" id="diaryTitle" class="form-control" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Date</label>
                        <input type="date" id="diaryDate" class="form-control" value="">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Content *</label>
                        <textarea id="diaryContent" class="form-control" rows="6" required
                            placeholder="Write your diary entry here..."></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Tags (comma separated)</label>
                        <input type="text" id="diaryTags" class="form-control"
                            placeholder="business, inventory, meeting, etc.">
                    </div>

                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        <button type="submit" class="btn">
                            <i class="fas fa-save"></i>
                            Save Entry
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="closeDiaryModal()">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- View Item Modal -->
    <div class="modal" id="viewItemModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Item Details</h3>
                <button class="close-modal" onclick="closeViewModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="itemModalContent">
                    <!-- Item details will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Image Gallery Modal -->
    <div class="modal image-gallery-modal" id="imageGalleryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Item Images</h3>
                <button class="close-modal" onclick="closeImageGallery()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="gallery-container">
                    <div class="main-gallery-image">
                        <img id="mainGalleryImage" src="" alt="Main Image">
                    </div>
                    <div class="gallery-thumbnails" id="galleryThumbnails">
                        <!-- Thumbnails will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Profile Modal -->
    <div class="modal" id="userProfileModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Profile</h3>
                <button class="close-modal" onclick="closeUserProfileModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="profile-avatar" id="profileAvatar">RS</div>
                <form id="userProfileForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Full Name *</label>
                            <input type="text" id="profileName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email *</label>
                            <input type="email" id="profileEmail" class="form-control" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Phone Number *</label>
                            <input type="tel" id="profilePhone" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Shop Name *</label>
                            <input type="text" id="profileShopName" class="form-control" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Shop Address</label>
                        <textarea id="profileShopAddress" class="form-control" rows="3"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Change Avatar Initials</label>
                        <input type="text" id="profileAvatarInitials" class="form-control" maxlength="2"
                            placeholder="RS">
                    </div>

                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        <button type="submit" class="btn">
                            <i class="fas fa-save"></i>
                            Save Profile
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="closeUserProfileModal()">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Sale Recording Modal -->
    <div class="modal" id="saleModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Record New Sale</h3>
                <button class="close-modal" onclick="closeSaleModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="saleForm">
                    <div class="form-group">
                        <label class="form-label">Select Item *</label>
                        <select id="saleItem" class="form-control" required>
                            <option value="">Select an item</option>
                            <!-- Items will be populated dynamically -->
                        </select>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Available Stock</label>
                            <input type="text" id="availableStock" class="form-control" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Selling Price</label>
                            <input type="text" id="salePrice" class="form-control currency" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Quantity *</label>
                            <input type="number" id="saleQuantity" class="form-control" min="1" value="1" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Customer Name</label>
                        <input type="text" id="customerName" class="form-control" placeholder="Optional">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Payment Method</label>
                        <select id="paymentMethod" class="form-control">
                            <option value="cash">Cash</option>
                            <option value="card">Card</option>
                            <option value="upi">UPI</option>
                            <option value="online">Online</option>
                        </select>
                    </div>

                    <div style="background: var(--light-gray); padding: 15px; border-radius: 10px; margin: 20px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <div>Subtotal:</div>
                            <div class="currency" id="saleSubtotal">0</div>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <div>Tax (<span id="taxRate">18</span>%):</div>
                            <div class="currency" id="saleTax">0</div>
                        </div>
                        <div
                            style="display: flex; justify-content: space-between; font-weight: 600; font-size: 1.2rem;">
                            <div>Total:</div>
                            <div class="currency" id="saleTotal">0</div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-check"></i>
                            Complete Sale
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="closeSaleModal()">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Success Notification -->
    <div id="successNotification"
        style="position: fixed; top: 20px; right: 20px; background: var(--success); color: white; padding: 15px 20px; border-radius: 10px; box-shadow: var(--card-shadow); z-index: 1001; display: none; align-items: center; gap: 10px; max-width: 350px;">
        <i class="fas fa-check-circle"></i>
        <span id="notificationMessage">Operation completed successfully!</span>
    </div>

    <!-- Error Notification -->
    <div id="errorNotification"
        style="position: fixed; top: 20px; right: 20px; background: var(--danger); color: white; padding: 15px 20px; border-radius: 10px; box-shadow: var(--card-shadow); z-index: 1001; display: none; align-items: center; gap: 10px; max-width: 350px;">
        <i class="fas fa-exclamation-circle"></i>
        <span id="errorMessage">An error occurred!</span>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Application Data - Initialize with empty arrays
        let inventory = [];
        let suppliers = [];
        let diaryEntries = [];
        let sales = [];
        let settings = {};
        let userProfile = {};

        // DOM Elements
        const pages = document.querySelectorAll('.page');
        const navLinks = document.querySelectorAll('.nav-link');
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const sidebar = document.querySelector('.sidebar');
        const itemForm = document.getElementById('itemForm');
        const inventoryTable = document.getElementById('inventoryTable');
        const recentActivityTable = document.getElementById('recentActivityTable');
        const suppliersTable = document.getElementById('suppliersTable');
        const diaryEntriesContainer = document.getElementById('diaryEntries');
        const filterToggle = document.getElementById('filterToggle');
        const filterSection = document.getElementById('filterSection');
        const imageUploadArea = document.getElementById('imageUploadArea');
        const imageInput = document.getElementById('imageInput');
        const imagePreview = document.getElementById('imagePreview');
        const userProfileBtn = document.getElementById('userProfileBtn');
        const itemSupplierSelect = document.getElementById('itemSupplier');
        const saleItemSelect = document.getElementById('saleItem');

        // Chart instance
        let salesChart = null;

        // Current images for item form
        let currentImages = [];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            // Load data from localStorage
            loadAllData();

            // Initialize data displays
            updateDashboardStats();
            updateInventoryTable();
            updateRecentActivity();
            updateSuppliersTable();
            updateSupplierDropdown();
            updateDiaryEntries();
            initializeSalesChart();
            loadUserProfile();

            // Set current date in diary form
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('diaryDate').value = today;

            // Set up event listeners
            setupEventListeners();

            // Show dashboard on load
            showPage('dashboard');

            // Hide mobile menu button on large screens
            updateMobileMenuButton();
            window.addEventListener('resize', updateMobileMenuButton);
        });

        // Load all data from localStorage
        function loadAllData() {
            // Load inventory
            const savedInventory = localStorage.getItem('shopInventory');
            inventory = savedInventory ? JSON.parse(savedInventory) : [];

            // Load suppliers
            const savedSuppliers = localStorage.getItem('shopSuppliers');
            suppliers = savedSuppliers ? JSON.parse(savedSuppliers) : [];

            // Load diary entries
            const savedDiary = localStorage.getItem('shopDiary');
            diaryEntries = savedDiary ? JSON.parse(savedDiary) : [];

            // Load sales
            const savedSales = localStorage.getItem('shopSales');
            sales = savedSales ? JSON.parse(savedSales) : [];

            // Load settings
            const savedSettings = localStorage.getItem('shopSettings');
            settings = savedSettings ? JSON.parse(savedSettings) : {
                shopName: "Rohan's Super Shop",
                currency: "Indian Rupee (₹)",
                lowStockThreshold: 10,
                taxPercentage: 18,
                shopAddress: "123 Main Street, Mumbai, Maharashtra 400001",
                shopPhone: "+91 98765 43210",
                shopEmail: "contact@rohansshop.com"
            };

            // Load user profile
            const savedUserProfile = localStorage.getItem('shopUserProfile');
            userProfile = savedUserProfile ? JSON.parse(savedUserProfile) : {
                name: "Rohan Sharma",
                email: "rohan@shop.com",
                phone: "+91 98765 43210",
                shopName: "Rohan's Super Shop",
                shopAddress: "123 Main Street, Mumbai, Maharashtra 400001",
                avatarInitials: "RS"
            };

            // Apply settings
            applySettings();
        }

        // Save all data to localStorage
        function saveAllData() {
            localStorage.setItem('shopInventory', JSON.stringify(inventory));
            localStorage.setItem('shopSuppliers', JSON.stringify(suppliers));
            localStorage.setItem('shopDiary', JSON.stringify(diaryEntries));
            localStorage.setItem('shopSales', JSON.stringify(sales));
            localStorage.setItem('shopSettings', JSON.stringify(settings));
            localStorage.setItem('shopUserProfile', JSON.stringify(userProfile));
        }

        // Apply settings to the UI
        function applySettings() {
            document.getElementById('shopName').value = settings.shopName;
            document.getElementById('currency').value = settings.currency;
            document.getElementById('lowStockThreshold').value = settings.lowStockThreshold;
            document.getElementById('taxPercentage').value = settings.taxPercentage;
            document.getElementById('shopAddress').value = settings.shopAddress;
            document.getElementById('shopPhone').value = settings.shopPhone;
            document.getElementById('shopEmail').value = settings.shopEmail;
        }

        // Set up event listeners
        function setupEventListeners() {
            // Navigation
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const pageId = link.getAttribute('data-page');
                    showPage(pageId);

                    // Update active state
                    navLinks.forEach(nav => nav.classList.remove('active'));
                    link.classList.add('active');

                    // Update page title
                    updatePageTitle(pageId);
                });
            });

            // Mobile menu toggle
            mobileMenuBtn.addEventListener('click', () => {
                sidebar.classList.toggle('active');
            });

            // Close sidebar when clicking outside on mobile
            document.addEventListener('click', (e) => {
                if (window.innerWidth <= 992 &&
                    !sidebar.contains(e.target) &&
                    e.target !== mobileMenuBtn &&
                    !mobileMenuBtn.contains(e.target)) {
                    sidebar.classList.remove('active');
                }
            });

            // Item form submission
            itemForm.addEventListener('submit', saveItem);

            // Filter toggle
            filterToggle.addEventListener('click', () => {
                filterSection.style.display = filterSection.style.display === 'none' ? 'block' : 'none';
            });

            // Image upload
            imageUploadArea.addEventListener('click', () => imageInput.click());
            imageInput.addEventListener('change', handleImageUpload);

            // Drag and drop for images
            imageUploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                imageUploadArea.style.borderColor = 'var(--primary)';
                imageUploadArea.style.background = 'rgba(79, 70, 229, 0.05)';
            });

            imageUploadArea.addEventListener('dragleave', () => {
                imageUploadArea.style.borderColor = '#ccc';
                imageUploadArea.style.background = 'white';
            });

            imageUploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                imageUploadArea.style.borderColor = '#ccc';
                imageUploadArea.style.background = 'white';

                if (e.dataTransfer.files.length) {
                    imageInput.files = e.dataTransfer.files;
                    handleImageUpload();
                }
            });


            // Global search
            document.getElementById('globalSearch').addEventListener('input', performGlobalSearch);

            // Diary search
            document.getElementById('diarySearch').addEventListener('input', searchDiaryEntries);

            // Sales period change
            document.getElementById('salesPeriod').addEventListener('change', updateSalesChart);

            // Supplier form submission
            document.getElementById('supplierForm').addEventListener('submit', saveSupplier);

            // Diary form submission
            document.getElementById('diaryForm').addEventListener('submit', saveDiaryEntry);

            // User profile click
            userProfileBtn.addEventListener('click', openUserProfileModal);

            // User profile form submission
            document.getElementById('userProfileForm').addEventListener('submit', saveUserProfile);

            // Sale form events
            document.getElementById('saleItem').addEventListener('change', updateSaleDetails);
            document.getElementById('saleQuantity').addEventListener('input', updateSaleTotal);

            // Sale form submission
            document.getElementById('saleForm').addEventListener('submit', completeSale);

            // Shop status toggle
            document.getElementById('shopStatusToggle').addEventListener('change', updateShopStatus);
        }

        // Update mobile menu button visibility
        function updateMobileMenuButton() {
            if (window.innerWidth >= 993) {
                mobileMenuBtn.style.display = 'none';
            } else {
                mobileMenuBtn.style.display = 'block';
            }
        }

        // Show a specific page
        function showPage(pageId) {
            pages.forEach(page => {
                page.classList.remove('active');
                if (page.id === pageId) {
                    page.classList.add('active');
                }
            });

            // Update page title
            updatePageTitle(pageId);

            // Close sidebar on mobile after navigation
            if (window.innerWidth <= 992) {
                sidebar.classList.remove('active');
            }

            // Update specific page data if needed
            if (pageId === 'sales') {
                updateSalesChart();
            } else if (pageId === 'reports') {
                // Clear report preview
                document.getElementById('reportPreview').innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-file-alt"></i>
                        <div>Select a report to generate preview</div>
                    </div>
                `;
            }
        }

        // Update page title based on active page
        function updatePageTitle(pageId) {
            const pageTitle = document.querySelector('.page-title span');
            const pageIcon = document.querySelector('.page-title i');

            const pageTitles = {
                'dashboard': { title: 'Dashboard Overview', icon: 'fa-tachometer-alt' },
                'inventory': { title: 'Inventory Management', icon: 'fa-boxes' },
                'add-item': { title: 'Add New Item', icon: 'fa-plus-circle' },
                'suppliers': { title: 'Supplier Management', icon: 'fa-truck' },
                'sales': { title: 'Sales Analytics', icon: 'fa-chart-line' },
                'diary': { title: 'Business Diary', icon: 'fa-book' },
                'reports': { title: 'Reports & Analytics', icon: 'fa-file-alt' },
                'settings': { title: 'Settings', icon: 'fa-cog' }
            };

            if (pageTitles[pageId]) {
                pageTitle.textContent = pageTitles[pageId].title;
                pageIcon.className = `fas ${pageTitles[pageId].icon}`;
            }
        }

        // Update dashboard statistics
        function updateDashboardStats() {
            const totalItems = inventory.reduce((sum, item) => sum + item.quantity, 0);
            const inventoryValue = inventory.reduce((sum, item) => sum + (item.purchasePrice * item.quantity), 0);
            const monthlySales = calculateMonthlySales();
            const profitMargin = inventory.length > 0 ?
                inventory.reduce((sum, item) => {
                    const profit = item.sellingPrice - item.purchasePrice;
                    return sum + (profit / item.purchasePrice * 100);
                }, 0) / inventory.length : 0;

            const lowStockItems = inventory.filter(item => item.quantity <= settings.lowStockThreshold).length;

            // Format values with Indian Rupee symbol
            document.getElementById('totalItems').textContent = totalItems.toLocaleString('en-IN');
            document.getElementById('inventoryValue').textContent = inventoryValue.toLocaleString('en-IN');
            document.getElementById('monthlySales').textContent = monthlySales.toLocaleString('en-IN');
            document.getElementById('profitMargin').textContent = profitMargin.toFixed(1) + '%';
            document.getElementById('suppliersCount').textContent = suppliers.length;
            document.getElementById('lowStockItems').textContent = lowStockItems;

            // Update change indicators (simulated for demo)
            document.getElementById('itemsChange').textContent = `${Math.floor(Math.random() * 20) + 1}% from last month`;
            document.getElementById('valueChange').textContent = `${Math.floor(Math.random() * 15) + 1}% from last month`;
            document.getElementById('salesChange').textContent = `${Math.floor(Math.random() * 25) + 1}% from last month`;
            document.getElementById('marginChange').textContent = `${Math.floor(Math.random() * 5) + 1}% from last month`;
            document.getElementById('suppliersChange').textContent = `${Math.floor(Math.random() * 3) + 1} from last month`;
            document.getElementById('lowStockChange').textContent = `${lowStockItems} items need attention`;
        }

        // Calculate monthly sales
        function calculateMonthlySales() {
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();

            return sales.reduce((sum, sale) => {
                const saleDate = new Date(sale.date);
                if (saleDate.getMonth() === currentMonth && saleDate.getFullYear() === currentYear) {
                    return sum + sale.totalAmount;
                }
                return sum;
            }, 0);
        }

        // Update inventory table
        function updateInventoryTable(filteredInventory = inventory) {
            inventoryTable.innerHTML = '';

            if (filteredInventory.length === 0) {
                inventoryTable.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state" style="text-align: center; padding: 40px;">
                            <i class="fas fa-box-open"></i>
                            <div>No items found. Add your first item!</div>
                        </td>
                    </tr>
                `;
                return;
            }

            filteredInventory.forEach(item => {
                const profit = item.sellingPrice - item.purchasePrice;
                const profitPercentage = ((profit / item.purchasePrice) * 100).toFixed(1);
                const stockStatus = item.quantity === 0 ? 'Out of Stock' : item.quantity <= settings.lowStockThreshold ? 'Low Stock' : 'In Stock';
                const stockClass = item.quantity === 0 ? 'badge-danger' : item.quantity <= settings.lowStockThreshold ? 'badge-warning' : 'badge-success';
                const itemValue = item.purchasePrice * item.quantity;

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td style="font-weight: 600;">${item.name}</td>
                    <td><span class="tag">${item.category}</span></td>
                    <td><span class="currency">${item.purchasePrice.toLocaleString('en-IN')}</span></td>
                    <td><span class="currency">${item.sellingPrice.toLocaleString('en-IN')}</span></td>
                    <td><span class="badge ${stockClass}">${item.quantity} (${stockStatus})</span></td>
                    <td><span class="currency">${itemValue.toLocaleString('en-IN')}</span></td>
                    <td>
                        <div class="actions">
                            <button class="action-btn view-btn" onclick="viewItem(${item.id})" title="View">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="action-btn edit-btn" onclick="editItem(${item.id})" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete-btn" onclick="deleteItem(${item.id})" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                inventoryTable.appendChild(row);
            });
        }

        // Update recent activity table
        function updateRecentActivity() {
            recentActivityTable.innerHTML = '';

            // Get 5 most recent items
            const recentItems = [...inventory]
                .sort((a, b) => new Date(b.lastUpdated || b.dateAdded) - new Date(a.lastUpdated || a.dateAdded))
                .slice(0, 5);

            if (recentItems.length === 0) {
                recentActivityTable.innerHTML = `
                    <tr>
                        <td colspan="6" class="empty-state" style="text-align: center; padding: 40px;">
                            <i class="fas fa-history"></i>
                            <div>No recent activity</div>
                        </td>
                    </tr>
                `;
                return;
            }

            recentItems.forEach(item => {
                const lastUpdated = new Date(item.lastUpdated || item.dateAdded);
                const formattedDate = lastUpdated.toLocaleDateString('en-IN', {
                    day: 'numeric',
                    month: 'short',
                    year: 'numeric'
                });

                const stockStatus = item.quantity === 0 ? 'Out of Stock' : item.quantity <= settings.lowStockThreshold ? 'Low Stock' : 'In Stock';
                const statusClass = item.quantity === 0 ? 'badge-danger' : item.quantity <= settings.lowStockThreshold ? 'badge-warning' : 'badge-success';

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td style="font-weight: 600;">${item.name}</td>
                    <td><span class="tag">${item.category}</span></td>
                    <td>${item.quantity} units</td>
                    <td>${formattedDate}</td>
                    <td><span class="badge ${statusClass}">${stockStatus}</span></td>
                    <td>
                        <div class="actions">
                            <button class="action-btn view-btn" onclick="viewItem(${item.id})" title="View">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </td>
                `;
                recentActivityTable.appendChild(row);
            });
        }

        // Update suppliers table
        function updateSuppliersTable() {
            suppliersTable.innerHTML = '';

            if (suppliers.length === 0) {
                suppliersTable.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state" style="text-align: center; padding: 40px;">
                            <i class="fas fa-truck"></i>
                            <div>No suppliers added yet</div>
                        </td>
                    </tr>
                `;
                return;
            }

            suppliers.forEach(supplier => {
                const lastOrder = supplier.lastOrder ? new Date(supplier.lastOrder) : new Date();
                const formattedDate = lastOrder.toLocaleDateString('en-IN', {
                    day: 'numeric',
                    month: 'short',
                    year: 'numeric'
                });

                const itemsText = supplier.items && supplier.items.length > 0 ?
                    supplier.items.map(item => {
                        const categories = {
                            'electronics': 'Electronics',
                            'clothing': 'Clothing',
                            'home': 'Home & Kitchen',
                            'groceries': 'Groceries',
                            'beauty': 'Beauty & Health',
                            'sports': 'Sports & Outdoors',
                            'other': 'Other'
                        };
                        return categories[item] || item;
                    }).join(', ') : 'Not specified';

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td style="font-weight: 600;">${supplier.name}</td>
                    <td>${supplier.contact}</td>
                    <td>${supplier.phone}</td>
                    <td>${supplier.email || '-'}</td>
                    <td>${itemsText}</td>
                    <td>${formattedDate}</td>
                    <td>
                        <div class="actions">
                            <button class="action-btn edit-btn" onclick="editSupplier(${supplier.id})" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete-btn" onclick="deleteSupplier(${supplier.id})" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                suppliersTable.appendChild(row);
            });
        }

        // Update supplier dropdown in add item form
        function updateSupplierDropdown() {
            itemSupplierSelect.innerHTML = '<option value="">Select Supplier</option>';

            if (suppliers.length === 0) {
                const option = document.createElement('option');
                option.value = "";
                option.textContent = "No suppliers available";
                option.disabled = true;
                itemSupplierSelect.appendChild(option);
                return;
            }

            suppliers.forEach(supplier => {
                const option = document.createElement('option');
                option.value = supplier.id;
                option.textContent = supplier.name;
                itemSupplierSelect.appendChild(option);
            });
        }

        // Update sale item dropdown
        function updateSaleItemDropdown() {
            saleItemSelect.innerHTML = '<option value="">Select an item</option>';

            // Only show items with stock > 0
            const availableItems = inventory.filter(item => item.quantity > 0);

            if (availableItems.length === 0) {
                const option = document.createElement('option');
                option.value = "";
                option.textContent = "No items in stock";
                option.disabled = true;
                saleItemSelect.appendChild(option);
                return;
            }

            availableItems.forEach(item => {
                const option = document.createElement('option');
                option.value = item.id;
                option.textContent = `${item.name} (Stock: ${item.quantity})`;
                saleItemSelect.appendChild(option);
            });
        }

        // Update diary entries
        function updateDiaryEntries(filteredEntries = diaryEntries) {
            diaryEntriesContainer.innerHTML = '';

            if (filteredEntries.length === 0) {
                diaryEntriesContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-book-open"></i>
                        <div>No diary entries found. Create your first entry!</div>
                    </div>
                `;
                return;
            }

            // Sort by date (newest first)
            const sortedEntries = [...filteredEntries].sort((a, b) => new Date(b.date) - new Date(a.date));

            sortedEntries.forEach(entry => {
                const entryDate = new Date(entry.date);
                const formattedDate = entryDate.toLocaleDateString('en-IN', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });

                const entryDiv = document.createElement('div');
                entryDiv.className = 'diary-entry';
                entryDiv.innerHTML = `
                    <div class="diary-header">
                        <div class="diary-date">${formattedDate}</div>
                        <div>
                            <button class="action-btn edit-btn" onclick="editDiaryEntry(${entry.id})" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete-btn" onclick="deleteDiaryEntry(${entry.id})" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <h3 style="margin-bottom: 10px; color: var(--dark);">${entry.title}</h3>
                    <div class="diary-content">${entry.content.replace(/\n/g, '<br>')}</div>
                    ${entry.tags && entry.tags.length > 0 ? `
                        <div class="diary-tags">
                            ${entry.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                        </div>
                    ` : ''}
                `;
                diaryEntriesContainer.appendChild(entryDiv);
            });
        }

        // Save item to inventory
        function saveItem(e) {
            e.preventDefault();

            // Get form values
            const name = document.getElementById('itemName').value.trim();
            const description = document.getElementById('itemDescription').value.trim();
            const purchasePrice = parseFloat(document.getElementById('purchasePrice').value);
            const sellingPrice = parseFloat(document.getElementById('sellingPrice').value);
            const quantity = parseInt(document.getElementById('itemQuantity').value);
            const category = document.getElementById('itemCategory').value;
            const supplierId = document.getElementById('itemSupplier').value;

            // Validate prices
            if (sellingPrice < purchasePrice) {
                showError('Selling price should be higher than purchase price for profit!');
                return;
            }

            if (sellingPrice <= 0 || purchasePrice <= 0) {
                showError('Prices must be greater than 0!');
                return;
            }

            // Find supplier name
            let supplierName = "";
            if (supplierId) {
                const supplier = suppliers.find(s => s.id == supplierId);
                supplierName = supplier ? supplier.name : "";
            }

            // Create item object
            const item = {
                id: Date.now(),
                name,
                description,
                purchasePrice,
                sellingPrice,
                quantity,
                category,
                supplierId,
                supplierName,
                images: [...currentImages],
                dateAdded: new Date().toISOString().split('T')[0],
                lastUpdated: new Date().toISOString().split('T')[0]
            };

            // Add to inventory
            inventory.unshift(item);
            saveAllData();

            // Update UI
            updateDashboardStats();
            updateInventoryTable();
            updateRecentActivity();
            updateSaleItemDropdown();

            // Reset form
            resetItemForm();

            // Show success message
            showNotification('Item added successfully!');

            // Navigate to inventory page
            showPage('inventory');
            navLinks.forEach(nav => nav.classList.remove('active'));
            document.querySelector('[data-page="inventory"]').classList.add('active');
        }

        // Handle image upload
        function handleImageUpload() {
            const files = Array.from(imageInput.files);

            // Limit to 5 images
            if (files.length + currentImages.length > 5) {
                showError('You can only upload up to 5 images');
                return;
            }

            // Process each file
            files.forEach(file => {
                // Check file size (max 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    showError(`File ${file.name} is too large. Maximum size is 5MB.`);
                    return;
                }

                // Check file type
                if (!file.type.match('image.*')) {
                    showError(`File ${file.name} is not an image.`);
                    return;
                }

                const reader = new FileReader();

                reader.onload = (e) => {
                    // Add to current images
                    currentImages.push(e.target.result);

                    // Update preview
                    updateImagePreview();
                };

                reader.readAsDataURL(file);
            });

            // Reset file input
            imageInput.value = '';
        }

        // Update image preview
        function updateImagePreview() {
            imagePreview.innerHTML = '';

            currentImages.forEach((image, index) => {
                const imageItem = document.createElement('div');
                imageItem.className = 'image-item';

                const img = document.createElement('img');
                img.src = image;
                img.alt = `Preview ${index + 1}`;

                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'remove-image';
                deleteBtn.innerHTML = '<i class="fas fa-times"></i>';
                deleteBtn.onclick = (e) => {
                    e.stopPropagation();
                    currentImages.splice(index, 1);
                    updateImagePreview();
                };

                imageItem.appendChild(img);
                imageItem.appendChild(deleteBtn);
                imagePreview.appendChild(imageItem);
            });
        }

        // Reset item form
        function resetItemForm() {
            itemForm.reset();
            currentImages = [];
            imagePreview.innerHTML = '';
            document.getElementById('itemCategory').value = "";
            document.getElementById('itemSupplier').value = "";
        }

        // Apply filters to inventory
        function applyFilters() {
            const nameFilter = document.getElementById('filterName').value.toLowerCase();
            const categoryFilter = document.getElementById('filterCategory').value;
            const stockFilter = document.getElementById('filterStock').value;

            let filtered = inventory;

            // Apply name filter
            if (nameFilter) {
                filtered = filtered.filter(item =>
                    item.name.toLowerCase().includes(nameFilter) ||
                    (item.description && item.description.toLowerCase().includes(nameFilter))
                );
            }

            // Apply category filter
            if (categoryFilter) {
                filtered = filtered.filter(item => item.category === categoryFilter);
            }

            // Apply stock filter
            if (stockFilter === 'low') {
                filtered = filtered.filter(item => item.quantity > 0 && item.quantity <= settings.lowStockThreshold);
            } else if (stockFilter === 'out') {
                filtered = filtered.filter(item => item.quantity === 0);
            } else if (stockFilter === 'good') {
                filtered = filtered.filter(item => item.quantity > settings.lowStockThreshold);
            }

            updateInventoryTable(filtered);
        }

        // Reset filters
        function resetFilters() {
            document.getElementById('filterName').value = '';
            document.getElementById('filterCategory').value = '';
            document.getElementById('filterStock').value = '';
            updateInventoryTable();
            filterSection.style.display = 'none';
        }

        // View item details
        function viewItem(itemId) {
            const item = inventory.find(item => item.id === itemId);
            if (!item) return;

            const profit = item.sellingPrice - item.purchasePrice;
            const profitPercentage = ((profit / item.purchasePrice) * 100).toFixed(1);
            const stockStatus = item.quantity === 0 ? 'Out of Stock' : item.quantity <= settings.lowStockThreshold ? 'Low Stock' : 'In Stock';
            const stockClass = item.quantity === 0 ? 'badge-danger' : item.quantity <= settings.lowStockThreshold ? 'badge-warning' : 'badge-success';
            const itemValue = item.purchasePrice * item.quantity;

            document.getElementById('itemModalContent').innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        ${item.images.length > 0 ? `
                            <img src="${item.images[0]}" alt="${item.name}" style="width: 100%; border-radius: 10px; cursor: pointer;" onclick="openImageGallery(${itemId})">
                            <div style="text-align: center; margin-top: 10px; color: var(--gray);">
                                ${item.images.length} image(s) - Click to view all
                            </div>
                        ` : `
                            <div style="width: 100%; height: 200px; background: var(--light-gray); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-image" style="font-size: 3rem; color: #ccc;"></i>
                            </div>
                        `}
                    </div>
                    <div>
                        <h3 style="margin-bottom: 10px;">${item.name}</h3>
                        <p style="color: var(--gray); margin-bottom: 15px;">${item.description || 'No description provided'}</p>
                        <div style="display: flex; gap: 15px; margin-bottom: 15px; flex-wrap: wrap;">
                            <div>
                                <div style="font-size: 0.9rem; color: var(--gray);">Purchase Price</div>
                                <div style="font-size: 1.2rem; font-weight: 600;"><span class="currency">${item.purchasePrice.toLocaleString('en-IN')}</span></div>
                            </div>
                            <div>
                                <div style="font-size: 0.9rem; color: var(--gray);">Selling Price</div>
                                <div style="font-size: 1.2rem; font-weight: 600; color: var(--success);"><span class="currency">${item.sellingPrice.toLocaleString('en-IN')}</span></div>
                            </div>
                            <div>
                                <div style="font-size: 0.9rem; color: var(--gray);">Profit Margin</div>
                                <div style="font-size: 1.2rem; font-weight: 600; color: var(--accent);">${profitPercentage}%</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
                    <div style="background: var(--light-gray); padding: 15px; border-radius: 10px;">
                        <div style="font-size: 0.9rem; color: var(--gray);">Category</div>
                        <div style="font-weight: 600;">${item.category.charAt(0).toUpperCase() + item.category.slice(1)}</div>
                    </div>
                    <div style="background: var(--light-gray); padding: 15px; border-radius: 10px;">
                        <div style="font-size: 0.9rem; color: var(--gray);">Quantity in Stock</div>
                        <div style="font-weight: 600;">${item.quantity} units</div>
                    </div>
                    <div style="background: var(--light-gray); padding: 15px; border-radius: 10px;">
                        <div style="font-size: 0.9rem; color: var(--gray);">Stock Status</div>
                        <div style="font-weight: 600;"><span class="badge ${stockClass}">${stockStatus}</span></div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
                    <div style="background: var(--light-gray); padding: 15px; border-radius: 10px;">
                        <div style="font-size: 0.9rem; color: var(--gray);">Total Value</div>
                        <div style="font-size: 1.2rem; font-weight: 600;"><span class="currency">${itemValue.toLocaleString('en-IN')}</span></div>
                    </div>
                    <div style="background: var(--light-gray); padding: 15px; border-radius: 10px;">
                        <div style="font-size: 0.9rem; color: var(--gray);">Supplier</div>
                        <div style="font-weight: 600;">${item.supplierName || 'Not specified'}</div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn" onclick="editItem(${item.id}); closeViewModal();">
                        <i class="fas fa-edit"></i>
                        Edit Item
                    </button>
                    <button class="btn btn-secondary" onclick="closeViewModal()">
                        Close
                    </button>
                </div>
            `;

            document.getElementById('viewItemModal').style.display = 'flex';
        }

        // Open image gallery
        function openImageGallery(itemId) {
            const item = inventory.find(item => item.id === itemId);
            if (!item || !item.images || item.images.length === 0) return;

            const mainGalleryImage = document.getElementById('mainGalleryImage');
            const galleryThumbnails = document.getElementById('galleryThumbnails');

            // Set main image
            mainGalleryImage.src = item.images[0];

            // Create thumbnails
            galleryThumbnails.innerHTML = '';
            item.images.forEach((image, index) => {
                const thumb = document.createElement('div');
                thumb.className = `gallery-thumb ${index === 0 ? 'active' : ''}`;
                thumb.onclick = () => {
                    // Update main image
                    mainGalleryImage.src = image;

                    // Update active thumbnail
                    document.querySelectorAll('.gallery-thumb').forEach(t => t.classList.remove('active'));
                    thumb.classList.add('active');
                };

                const img = document.createElement('img');
                img.src = image;
                img.alt = `Image ${index + 1}`;

                thumb.appendChild(img);
                galleryThumbnails.appendChild(thumb);
            });

            document.getElementById('imageGalleryModal').style.display = 'flex';
        }

        // Close image gallery
        function closeImageGallery() {
            document.getElementById('imageGalleryModal').style.display = 'none';
        }

        // Edit item
        function editItem(itemId) {
            const item = inventory.find(item => item.id === itemId);
            if (!item) return;

            // Populate form with item data
            document.getElementById('itemName').value = item.name;
            document.getElementById('itemDescription').value = item.description || '';
            document.getElementById('purchasePrice').value = item.purchasePrice;
            document.getElementById('sellingPrice').value = item.sellingPrice;
            document.getElementById('itemQuantity').value = item.quantity;
            document.getElementById('itemCategory').value = item.category;
            document.getElementById('itemSupplier').value = item.supplierId || '';
            currentImages = item.images || [];
            updateImagePreview();

            // Change form to edit mode
            const formTitle = document.querySelector('#add-item .section-title');
            formTitle.innerHTML = `<i class="fas fa-edit"></i> Edit Item`;

            // Change button text
            const submitBtn = itemForm.querySelector('button[type="submit"]');
            submitBtn.innerHTML = '<i class="fas fa-save"></i> Update Item';

            // Store the item ID for updating
            itemForm.setAttribute('data-edit-id', itemId);

            // Navigate to add-item page
            showPage('add-item');
            navLinks.forEach(nav => nav.classList.remove('active'));
            document.querySelector('[data-page="add-item"]').classList.add('active');
        }

        // Update the saveItem function to handle edits
        itemForm.addEventListener('submit', function (e) {
            e.preventDefault();

            const editId = this.getAttribute('data-edit-id');
            if (editId) {
                // Update existing item
                const item = inventory.find(item => item.id == editId);
                if (item) {
                    // Get form values
                    item.name = document.getElementById('itemName').value.trim();
                    item.description = document.getElementById('itemDescription').value.trim();
                    item.purchasePrice = parseFloat(document.getElementById('purchasePrice').value);
                    item.sellingPrice = parseFloat(document.getElementById('sellingPrice').value);
                    item.quantity = parseInt(document.getElementById('itemQuantity').value);
                    item.category = document.getElementById('itemCategory').value;
                    item.supplierId = document.getElementById('itemSupplier').value;
                    item.images = [...currentImages];
                    item.lastUpdated = new Date().toISOString().split('T')[0];

                    // Find supplier name
                    if (item.supplierId) {
                        const supplier = suppliers.find(s => s.id == item.supplierId);
                        item.supplierName = supplier ? supplier.name : "";
                    }

                    saveAllData();

                    // Update UI
                    updateDashboardStats();
                    updateInventoryTable();
                    updateRecentActivity();
                    updateSaleItemDropdown();

                    // Reset form
                    resetItemForm();

                    // Reset form to add mode
                    const formTitle = document.querySelector('#add-item .section-title');
                    formTitle.innerHTML = `<i class="fas fa-plus-circle"></i> Add New Item to Inventory`;
                    const submitBtn = itemForm.querySelector('button[type="submit"]');
                    submitBtn.innerHTML = '<i class="fas fa-save"></i> Save Item';
                    itemForm.removeAttribute('data-edit-id');

                    showNotification('Item updated successfully!');

                    // Navigate to inventory page
                    showPage('inventory');
                    navLinks.forEach(nav => nav.classList.remove('active'));
                    document.querySelector('[data-page="inventory"]').classList.add('active');
                }
            } else {
                // Add new item (original functionality)
                saveItem(e);
            }
        });

        // Delete item
        function deleteItem(itemId) {
            if (confirm('Are you sure you want to delete this item? This action cannot be undone.')) {
                inventory = inventory.filter(item => item.id !== itemId);
                saveAllData();

                updateDashboardStats();
                updateInventoryTable();
                updateRecentActivity();
                updateSaleItemDropdown();

                showNotification('Item deleted successfully!');
            }
        }

        // Open supplier modal
        function openSupplierModal() {
            document.getElementById('supplierModal').style.display = 'flex';
        }

        // Close supplier modal
        function closeSupplierModal() {
            document.getElementById('supplierModal').style.display = 'none';
            document.getElementById('supplierForm').reset();
        }

        // Save supplier
        function saveSupplier(e) {
            e.preventDefault();

            const name = document.getElementById('supplierName').value.trim();
            const contact = document.getElementById('supplierContact').value.trim();
            const phone = document.getElementById('supplierPhone').value.trim();
            const email = document.getElementById('supplierEmail').value.trim();
            const address = document.getElementById('supplierAddress').value.trim();
            const items = Array.from(document.getElementById('supplierItems').selectedOptions).map(opt => opt.value);

            const supplier = {
                id: Date.now(),
                name,
                contact,
                phone,
                email,
                address,
                items,
                lastOrder: new Date().toISOString().split('T')[0]
            };

            suppliers.push(supplier);
            saveAllData();

            updateSuppliersTable();
            updateSupplierDropdown();
            updateDashboardStats();
            closeSupplierModal();

            showNotification('Supplier added successfully!');
        }

        // Edit supplier
        function editSupplier(supplierId) {
            const supplier = suppliers.find(s => s.id === supplierId);
            if (!supplier) return;

            // Populate supplier modal with data
            document.getElementById('supplierName').value = supplier.name;
            document.getElementById('supplierContact').value = supplier.contact;
            document.getElementById('supplierPhone').value = supplier.phone;
            document.getElementById('supplierEmail').value = supplier.email || '';
            document.getElementById('supplierAddress').value = supplier.address || '';

            // Set selected items
            const itemsSelect = document.getElementById('supplierItems');
            Array.from(itemsSelect.options).forEach(option => {
                option.selected = supplier.items && supplier.items.includes(option.value);
            });

            // Change modal title
            document.querySelector('#supplierModal .modal-title').textContent = 'Edit Supplier';

            // Change button text
            const submitBtn = document.querySelector('#supplierForm button[type="submit"]');
            submitBtn.innerHTML = '<i class="fas fa-save"></i> Update Supplier';

            // Store supplier ID for update
            document.getElementById('supplierForm').setAttribute('data-edit-id', supplierId);

            openSupplierModal();
        }

        // Update supplier form submission to handle edits
        document.getElementById('supplierForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const editId = this.getAttribute('data-edit-id');
            if (editId) {
                // Update existing supplier
                const supplier = suppliers.find(s => s.id == editId);
                if (supplier) {
                    supplier.name = document.getElementById('supplierName').value.trim();
                    supplier.contact = document.getElementById('supplierContact').value.trim();
                    supplier.phone = document.getElementById('supplierPhone').value.trim();
                    supplier.email = document.getElementById('supplierEmail').value.trim();
                    supplier.address = document.getElementById('supplierAddress').value.trim();
                    supplier.items = Array.from(document.getElementById('supplierItems').selectedOptions).map(opt => opt.value);

                    saveAllData();

                    updateSuppliersTable();
                    updateSupplierDropdown();

                    // Update supplier name in inventory items
                    inventory.forEach(item => {
                        if (item.supplierId == editId) {
                            item.supplierName = supplier.name;
                        }
                    });
                    saveAllData();
                    updateInventoryTable();

                    // Reset form and modal
                    closeSupplierModal();
                    document.getElementById('supplierForm').reset();
                    document.querySelector('#supplierModal .modal-title').textContent = 'Add New Supplier';
                    const submitBtn = document.querySelector('#supplierForm button[type="submit"]');
                    submitBtn.innerHTML = '<i class="fas fa-save"></i> Save Supplier';
                    this.removeAttribute('data-edit-id');

                    showNotification('Supplier updated successfully!');
                }
            } else {
                // Add new supplier
                saveSupplier(e);
            }
        });

        // Delete supplier
        function deleteSupplier(supplierId) {
            if (confirm('Are you sure you want to delete this supplier?')) {
                // Check if any items use this supplier
                const itemsUsingSupplier = inventory.filter(item => item.supplierId == supplierId);
                if (itemsUsingSupplier.length > 0) {
                    if (!confirm(`This supplier is used by ${itemsUsingSupplier.length} item(s). Deleting will remove the supplier reference from these items. Continue?`)) {
                        return;
                    }

                    // Remove supplier reference from items
                    inventory.forEach(item => {
                        if (item.supplierId == supplierId) {
                            item.supplierId = "";
                            item.supplierName = "";
                        }
                    });
                }

                suppliers = suppliers.filter(s => s.id !== supplierId);
                saveAllData();

                updateSuppliersTable();
                updateSupplierDropdown();
                updateInventoryTable();
                updateDashboardStats();

                showNotification('Supplier deleted successfully!');
            }
        }

        // Initialize sales chart
        function initializeSalesChart() {
            const ctx = document.getElementById('salesChart');
            if (!ctx) return;

            // Prepare data for chart
            const salesByDay = getSalesByDay(7); // Last 7 days

            const labels = Object.keys(salesByDay).map(date => {
                const d = new Date(date);
                return d.toLocaleDateString('en-IN', { weekday: 'short', day: 'numeric' });
            });

            const data = Object.values(salesByDay);

            if (salesChart) {
                salesChart.destroy();
            }

            salesChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Daily Sales (₹)',
                        data: data,
                        borderColor: 'var(--primary)',
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: 'var(--primary)',
                        pointBorderColor: 'white',
                        pointBorderWidth: 2,
                        pointRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return `Sales: ₹${context.raw.toLocaleString('en-IN')}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function (value) {
                                    return '₹' + value.toLocaleString('en-IN');
                                }
                            }
                        }
                    }
                }
            });

            // Update sales stats
            updateSalesStats();
        }

        // Get sales by day for the last N days
        function getSalesByDay(days) {
            const result = {};
            const today = new Date();

            // Initialize last N days with 0
            for (let i = days - 1; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                result[dateStr] = 0;
            }

            // Fill with actual sales data
            sales.forEach(sale => {
                const saleDate = sale.date.split('T')[0];
                if (result.hasOwnProperty(saleDate)) {
                    result[saleDate] += sale.totalAmount;
                }
            });

            return result;
        }

        // Update sales chart based on selected period
        function updateSalesChart() {
            const period = document.getElementById('salesPeriod').value;
            let days = 7;

            switch (period) {
                case 'month': days = 30; break;
                case 'quarter': days = 90; break;
                case 'year': days = 365; break;
                default: days = 7;
            }

            const salesByDay = getSalesByDay(days);
            const labels = Object.keys(salesByDay).map(date => {
                const d = new Date(date);
                if (days <= 7) {
                    return d.toLocaleDateString('en-IN', { weekday: 'short', day: 'numeric' });
                } else if (days <= 30) {
                    return d.toLocaleDateString('en-IN', { day: 'numeric', month: 'short' });
                } else {
                    return d.toLocaleDateString('en-IN', { month: 'short', year: 'numeric' });
                }
            });

            const data = Object.values(salesByDay);

            if (salesChart) {
                salesChart.data.labels = labels;
                salesChart.data.datasets[0].data = data;
                salesChart.update();
            }

            updateSalesStats();
        }

        // Update sales statistics
        function updateSalesStats() {
            const totalSales = sales.reduce((sum, sale) => sum + sale.totalAmount, 0);
            const avgTransaction = sales.length > 0 ? totalSales / sales.length : 0;

            // Find top category from sales
            const categorySales = {};
            sales.forEach(sale => {
                if (sale.category) {
                    categorySales[sale.category] = (categorySales[sale.category] || 0) + sale.totalAmount;
                }
            });

            let topCategory = '-';
            let maxSales = 0;

            for (const category in categorySales) {
                if (categorySales[category] > maxSales) {
                    maxSales = categorySales[category];
                    topCategory = category.charAt(0).toUpperCase() + category.slice(1);
                }
            }

            document.getElementById('totalSales').textContent = totalSales.toLocaleString('en-IN');
            document.getElementById('totalTransactions').textContent = sales.length;
            document.getElementById('avgTransaction').textContent = avgTransaction.toLocaleString('en-IN');
            document.getElementById('topCategory').textContent = topCategory;
        }

        // Record a sale
        function recordSale() {
            updateSaleItemDropdown();
            document.getElementById('saleModal').style.display = 'flex';
        }

        // Update sale details when item is selected
        function updateSaleDetails() {
            const itemId = document.getElementById('saleItem').value;
            if (!itemId) return;

            const item = inventory.find(item => item.id == itemId);
            if (item) {
                document.getElementById('availableStock').value = item.quantity;
                document.getElementById('salePrice').value = item.sellingPrice.toLocaleString('en-IN');
                document.getElementById('saleQuantity').max = item.quantity;
                document.getElementById('saleQuantity').value = Math.min(1, item.quantity);
                updateSaleTotal();
            }
        }

        // Update sale total
        function updateSaleTotal() {
            const quantity = parseInt(document.getElementById('saleQuantity').value) || 0;
            const price = parseFloat(document.getElementById('salePrice').value.replace(/[^0-9.-]+/g, "")) || 0;
            const taxRate = parseFloat(document.getElementById('taxPercentage').value) || 0;

            const subtotal = price * quantity;
            const tax = subtotal * (taxRate / 100);
            const total = subtotal + tax;

            document.getElementById('saleSubtotal').textContent = subtotal.toLocaleString('en-IN');
            document.getElementById('saleTax').textContent = tax.toLocaleString('en-IN');
            document.getElementById('saleTotal').textContent = total.toLocaleString('en-IN');
            document.getElementById('taxRate').textContent = taxRate;
        }

        // Complete sale
        function completeSale(e) {
            e.preventDefault();

            const itemId = document.getElementById('saleItem').value;
            const quantity = parseInt(document.getElementById('saleQuantity').value);
            const customerName = document.getElementById('customerName').value.trim();
            const paymentMethod = document.getElementById('paymentMethod').value;
            const totalAmount = parseFloat(document.getElementById('saleTotal').textContent.replace(/[^0-9.-]+/g, ""));

            const item = inventory.find(item => item.id == itemId);
            if (!item) {
                showError('Item not found!');
                return;
            }

            if (quantity > item.quantity) {
                showError('Not enough stock available!');
                return;
            }

            // Update item quantity
            item.quantity -= quantity;
            item.lastUpdated = new Date().toISOString().split('T')[0];

            // Record sale
            const sale = {
                id: Date.now(),
                itemId: item.id,
                itemName: item.name,
                category: item.category,
                quantity: quantity,
                unitPrice: item.sellingPrice,
                totalAmount: totalAmount,
                customerName: customerName || 'Walk-in Customer',
                paymentMethod: paymentMethod,
                date: new Date().toISOString()
            };

            sales.push(sale);
            saveAllData();

            // Update UI
            updateDashboardStats();
            updateInventoryTable();
            updateRecentActivity();
            updateSalesChart();

            // Close modal and reset form
            closeSaleModal();

            // Show success message with details
            showNotification(`Sale recorded successfully! ₹${totalAmount.toLocaleString('en-IN')} received for ${quantity} ${item.name}(s)`);
        }

        // Close sale modal
        function closeSaleModal() {
            document.getElementById('saleModal').style.display = 'none';
            document.getElementById('saleForm').reset();
        }

        // Open diary modal
        function openDiaryModal() {
            document.getElementById('diaryModal').style.display = 'flex';
        }

        // Close diary modal
        function closeDiaryModal() {
            document.getElementById('diaryModal').style.display = 'none';
            document.getElementById('diaryForm').reset();
            document.getElementById('diaryDate').value = new Date().toISOString().split('T')[0];
        }

        // Save diary entry
        function saveDiaryEntry(e) {
            e.preventDefault();

            const title = document.getElementById('diaryTitle').value.trim();
            const content = document.getElementById('diaryContent').value.trim();
            const date = document.getElementById('diaryDate').value || new Date().toISOString().split('T')[0];
            const tags = document.getElementById('diaryTags').value.split(',').map(tag => tag.trim()).filter(tag => tag);

            const entry = {
                id: Date.now(),
                title,
                content,
                date,
                tags
            };

            diaryEntries.unshift(entry);
            saveAllData();

            updateDiaryEntries();
            closeDiaryModal();

            showNotification('Diary entry saved successfully!');
        }

        // Edit diary entry
        function editDiaryEntry(entryId) {
            const entry = diaryEntries.find(entry => entry.id === entryId);
            if (!entry) return;

            // Populate diary modal with data
            document.getElementById('diaryTitle').value = entry.title;
            document.getElementById('diaryContent').value = entry.content;
            document.getElementById('diaryDate').value = entry.date;
            document.getElementById('diaryTags').value = entry.tags ? entry.tags.join(', ') : '';

            // Change modal title
            document.querySelector('#diaryModal .modal-title').textContent = 'Edit Diary Entry';

            // Change button text
            const submitBtn = document.querySelector('#diaryForm button[type="submit"]');
            submitBtn.innerHTML = '<i class="fas fa-save"></i> Update Entry';

            // Store entry ID for update
            document.getElementById('diaryForm').setAttribute('data-edit-id', entryId);

            openDiaryModal();
        }

        // Update diary form submission to handle edits
        document.getElementById('diaryForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const editId = this.getAttribute('data-edit-id');
            if (editId) {
                // Update existing entry
                const entry = diaryEntries.find(e => e.id == editId);
                if (entry) {
                    entry.title = document.getElementById('diaryTitle').value.trim();
                    entry.content = document.getElementById('diaryContent').value.trim();
                    entry.date = document.getElementById('diaryDate').value;
                    entry.tags = document.getElementById('diaryTags').value.split(',').map(tag => tag.trim()).filter(tag => tag);

                    saveAllData();

                    updateDiaryEntries();

                    // Reset form and modal
                    closeDiaryModal();
                    document.getElementById('diaryForm').reset();
                    document.querySelector('#diaryModal .modal-title').textContent = 'New Diary Entry';
                    const submitBtn = document.querySelector('#diaryForm button[type="submit"]');
                    submitBtn.innerHTML = '<i class="fas fa-save"></i> Save Entry';
                    this.removeAttribute('data-edit-id');

                    showNotification('Diary entry updated successfully!');
                }
            } else {
                // Add new entry
                saveDiaryEntry(e);
            }
        });

        // Delete diary entry
        function deleteDiaryEntry(entryId) {
            if (confirm('Are you sure you want to delete this diary entry?')) {
                diaryEntries = diaryEntries.filter(entry => entry.id !== entryId);
                saveAllData();

                updateDiaryEntries();

                showNotification('Diary entry deleted successfully!');
            }
        }

        // Search diary entries
        function searchDiaryEntries() {
            const searchTerm = document.getElementById('diarySearch').value.toLowerCase();

            if (!searchTerm) {
                updateDiaryEntries();
                return;
            }

            const filtered = diaryEntries.filter(entry =>
                entry.title.toLowerCase().includes(searchTerm) ||
                entry.content.toLowerCase().includes(searchTerm) ||
                (entry.tags && entry.tags.some(tag => tag.toLowerCase().includes(searchTerm)))
            );

            updateDiaryEntries(filtered);
        }

        // Perform global search
        function performGlobalSearch() {
            const searchTerm = document.getElementById('globalSearch').value.toLowerCase();

            if (!searchTerm) return;

            // Search in inventory
            const inventoryResults = inventory.filter(item =>
                item.name.toLowerCase().includes(searchTerm) ||
                (item.description && item.description.toLowerCase().includes(searchTerm))
            );

            // Search in diary
            const diaryResults = diaryEntries.filter(entry =>
                entry.title.toLowerCase().includes(searchTerm) ||
                entry.content.toLowerCase().includes(searchTerm)
            );

            // Search in suppliers
            const supplierResults = suppliers.filter(supplier =>
                supplier.name.toLowerCase().includes(searchTerm) ||
                supplier.contact.toLowerCase().includes(searchTerm)
            );

            // Show results
            if (inventoryResults.length > 0) {
                showPage('inventory');
                updateInventoryTable(inventoryResults);
                showNotification(`Found ${inventoryResults.length} item(s) matching "${searchTerm}"`);
            } else if (diaryResults.length > 0) {
                showPage('diary');
                updateDiaryEntries(diaryResults);
                showNotification(`Found ${diaryResults.length} diary entry/entries matching "${searchTerm}"`);
            } else if (supplierResults.length > 0) {
                showPage('suppliers');
                // Filter suppliers table
                const suppliersTable = document.getElementById('suppliersTable');
                suppliersTable.innerHTML = '';

                supplierResults.forEach(supplier => {
                    const lastOrder = supplier.lastOrder ? new Date(supplier.lastOrder) : new Date();
                    const formattedDate = lastOrder.toLocaleDateString('en-IN', {
                        day: 'numeric',
                        month: 'short',
                        year: 'numeric'
                    });

                    const itemsText = supplier.items && supplier.items.length > 0 ?
                        supplier.items.map(item => {
                            const categories = {
                                'electronics': 'Electronics',
                                'clothing': 'Clothing',
                                'home': 'Home & Kitchen',
                                'groceries': 'Groceries',
                                'beauty': 'Beauty & Health',
                                'sports': 'Sports & Outdoors',
                                'other': 'Other'
                            };
                            return categories[item] || item;
                        }).join(', ') : 'Not specified';

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td style="font-weight: 600;">${supplier.name}</td>
                        <td>${supplier.contact}</td>
                        <td>${supplier.phone}</td>
                        <td>${supplier.email || '-'}</td>
                        <td>${itemsText}</td>
                        <td>${formattedDate}</td>
                        <td>
                            <div class="actions">
                                <button class="action-btn edit-btn" onclick="editSupplier(${supplier.id})" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteSupplier(${supplier.id})" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    suppliersTable.appendChild(row);
                });

                showNotification(`Found ${supplierResults.length} supplier(s) matching "${searchTerm}"`);
            } else {
                showNotification(`No results found for "${searchTerm}"`, 'error');
            }
        }

        // Generate report
        function generateReport(type) {
            let reportContent = '';
            let reportTitle = '';

            switch (type) {
                case 'inventory':
                    reportTitle = 'Inventory Report';
                    reportContent = generateInventoryReport();
                    break;

                case 'sales':
                    reportTitle = 'Sales Report';
                    reportContent = generateSalesReport();
                    break;

                case 'supplier':
                    reportTitle = 'Supplier Report';
                    reportContent = generateSupplierReport();
                    break;

                case 'lowstock':
                    reportTitle = 'Low Stock Alert Report';
                    reportContent = generateLowStockReport();
                    break;

                default:
                    reportContent = `<div class="empty-state"><i class="fas fa-file-alt"></i><div>Select a report to generate preview</div></div>`;
            }

            document.getElementById('reportPreview').innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h3>${reportTitle}</h3>
                    <p>Generated on: ${new Date().toLocaleDateString('en-IN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
                </div>
                ${reportContent}
            `;

            // Store current report type for PDF export
            document.getElementById('reportPreview').setAttribute('data-report-type', type);
        }

        // Generate inventory report
        function generateInventoryReport() {
            if (inventory.length === 0) {
                return '<div class="empty-state"><i class="fas fa-box-open"></i><div>No inventory data available</div></div>';
            }

            const totalValue = inventory.reduce((sum, item) => sum + (item.purchasePrice * item.quantity), 0);
            const totalItems = inventory.reduce((sum, item) => sum + item.quantity, 0);
            const lowStockItems = inventory.filter(item => item.quantity <= settings.lowStockThreshold).length;

            let tableHtml = `
                <div style="overflow-x: auto; margin-top: 20px;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Item Name</th>
                                <th>Category</th>
                                <th>Purchase Price</th>
                                <th>Selling Price</th>
                                <th>Quantity</th>
                                <th>Stock Status</th>
                                <th>Total Value</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            inventory.forEach(item => {
                const stockStatus = item.quantity === 0 ? 'Out of Stock' : item.quantity <= settings.lowStockThreshold ? 'Low Stock' : 'In Stock';
                const stockClass = item.quantity === 0 ? 'badge-danger' : item.quantity <= settings.lowStockThreshold ? 'badge-warning' : 'badge-success';
                const itemValue = item.purchasePrice * item.quantity;

                tableHtml += `
                    <tr>
                        <td>${item.name}</td>
                        <td>${item.category.charAt(0).toUpperCase() + item.category.slice(1)}</td>
                        <td><span class="currency">${item.purchasePrice.toLocaleString('en-IN')}</span></td>
                        <td><span class="currency">${item.sellingPrice.toLocaleString('en-IN')}</span></td>
                        <td>${item.quantity}</td>
                        <td><span class="badge ${stockClass}">${stockStatus}</span></td>
                        <td><span class="currency">${itemValue.toLocaleString('en-IN')}</span></td>
                    </tr>
                `;
            });

            tableHtml += `
                        </tbody>
                    </table>
                </div>
                <div style="margin-top: 30px; padding: 20px; background: var(--light-gray); border-radius: 10px;">
                    <h4>Summary</h4>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 15px;">
                        <div style="background: white; padding: 15px; border-radius: 10px;">
                            <div style="font-size: 0.9rem; color: var(--gray);">Total Items</div>
                            <div style="font-size: 1.5rem; font-weight: 600;">${totalItems}</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 10px;">
                            <div style="font-size: 0.9rem; color: var(--gray);">Total Value</div>
                            <div style="font-size: 1.5rem; font-weight: 600;"><span class="currency">${totalValue.toLocaleString('en-IN')}</span></div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 10px;">
                            <div style="font-size: 0.9rem; color: var(--gray);">Low Stock Items</div>
                            <div style="font-size: 1.5rem; font-weight: 600; color: var(--danger);">${lowStockItems}</div>
                        </div>
                    </div>
                </div>
            `;

            return tableHtml;
        }

        // Generate sales report
        function generateSalesReport() {
            if (sales.length === 0) {
                return '<div class="empty-state"><i class="fas fa-chart-bar"></i><div>No sales data available</div></div>';
            }

            const totalSales = sales.reduce((sum, sale) => sum + sale.totalAmount, 0);
            const avgSale = sales.length > 0 ? totalSales / sales.length : 0;

            // Group by date for better visualization
            const salesByDate = {};
            sales.forEach(sale => {
                const date = sale.date.split('T')[0];
                if (!salesByDate[date]) {
                    salesByDate[date] = {
                        total: 0,
                        items: []
                    };
                }
                salesByDate[date].total += sale.totalAmount;
                salesByDate[date].items.push(sale);
            });

            // Sort dates
            const sortedDates = Object.keys(salesByDate).sort((a, b) => new Date(b) - new Date(a));

            let tableHtml = `
                <div style="overflow-x: auto; margin-top: 20px;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Item Name</th>
                                <th>Quantity</th>
                                <th>Unit Price</th>
                                <th>Total Amount</th>
                                <th>Customer</th>
                                <th>Payment Method</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            sortedDates.forEach(date => {
                const dateSales = salesByDate[date];
                dateSales.items.forEach((sale, index) => {
                    const saleDate = new Date(sale.date);
                    const formattedDate = saleDate.toLocaleDateString('en-IN', {
                        day: 'numeric',
                        month: 'short',
                        year: 'numeric'
                    });

                    tableHtml += `
                        <tr>
                            <td>${index === 0 ? formattedDate : ''}</td>
                            <td>${sale.itemName}</td>
                            <td>${sale.quantity}</td>
                            <td><span class="currency">${sale.unitPrice.toLocaleString('en-IN')}</span></td>
                            <td><span class="currency">${sale.totalAmount.toLocaleString('en-IN')}</span></td>
                            <td>${sale.customerName}</td>
                            <td>${sale.paymentMethod.charAt(0).toUpperCase() + sale.paymentMethod.slice(1)}</td>
                        </tr>
                    `;
                });
            });

            tableHtml += `
                        </tbody>
                    </table>
                </div>
                <div style="margin-top: 30px; padding: 20px; background: var(--light-gray); border-radius: 10px;">
                    <h4>Summary</h4>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 15px;">
                        <div style="background: white; padding: 15px; border-radius: 10px;">
                            <div style="font-size: 0.9rem; color: var(--gray);">Total Sales</div>
                            <div style="font-size: 1.5rem; font-weight: 600;"><span class="currency">${totalSales.toLocaleString('en-IN')}</span></div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 10px;">
                            <div style="font-size: 0.9rem; color: var(--gray);">Total Transactions</div>
                            <div style="font-size: 1.5rem; font-weight: 600;">${sales.length}</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 10px;">
                            <div style="font-size: 0.9rem; color: var(--gray);">Average Sale</div>
                            <div style="font-size: 1.5rem; font-weight: 600;"><span class="currency">${avgSale.toLocaleString('en-IN')}</span></div>
                        </div>
                    </div>
                </div>
            `;

            return tableHtml;
        }

        // Generate supplier report
        function generateSupplierReport() {
            if (suppliers.length === 0) {
                return '<div class="empty-state"><i class="fas fa-truck"></i><div>No supplier data available</div></div>';
            }

            let tableHtml = `
                <div style="overflow-x: auto; margin-top: 20px;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Supplier Name</th>
                                <th>Contact Person</th>
                                <th>Phone</th>
                                <th>Email</th>
                                <th>Items Supplied</th>
                                <th>Last Order</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            suppliers.forEach(supplier => {
                const lastOrder = supplier.lastOrder ? new Date(supplier.lastOrder) : new Date();
                const formattedDate = lastOrder.toLocaleDateString('en-IN', {
                    day: 'numeric',
                    month: 'short',
                    year: 'numeric'
                });

                const itemsText = supplier.items && supplier.items.length > 0 ?
                    supplier.items.map(item => {
                        const categories = {
                            'electronics': 'Electronics',
                            'clothing': 'Clothing',
                            'home': 'Home & Kitchen',
                            'groceries': 'Groceries',
                            'beauty': 'Beauty & Health',
                            'sports': 'Sports & Outdoors',
                            'other': 'Other'
                        };
                        return categories[item] || item;
                    }).join(', ') : 'Not specified';

                tableHtml += `
                    <tr>
                        <td>${supplier.name}</td>
                        <td>${supplier.contact}</td>
                        <td>${supplier.phone}</td>
                        <td>${supplier.email || '-'}</td>
                        <td>${itemsText}</td>
                        <td>${formattedDate}</td>
                    </tr>
                `;
            });

            tableHtml += `
                        </tbody>
                    </table>
                </div>
                <div style="margin-top: 30px; padding: 20px; background: var(--light-gray); border-radius: 10px;">
                    <h4>Summary</h4>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 15px;">
                        <div style="background: white; padding: 15px; border-radius: 10px;">
                            <div style="font-size: 0.9rem; color: var(--gray);">Total Suppliers</div>
                            <div style="font-size: 1.5rem; font-weight: 600;">${suppliers.length}</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 10px;">
                            <div style="font-size: 0.9rem; color: var(--gray);">Items from Suppliers</div>
                            <div style="font-size: 1.5rem; font-weight: 600;">${inventory.filter(item => item.supplierId).length}</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 10px;">
                            <div style="font-size: 0.9rem; color: var(--gray);">Active Suppliers</div>
                            <div style="font-size: 1.5rem; font-weight: 600; color: var(--success);">${suppliers.filter(s => s.lastOrder && new Date(s.lastOrder) > new Date(Date.now() - 30 * 24 * 60 * 60 * 1000)).length}</div>
                        </div>
                    </div>
                </div>
            `;

            return tableHtml;
        }

        // Generate low stock report
        function generateLowStockReport() {
            const lowStockItems = inventory.filter(item => item.quantity <= settings.lowStockThreshold);

            if (lowStockItems.length === 0) {
                return '<div class="empty-state"><i class="fas fa-check-circle" style="color: var(--success);"></i><div>No low stock items. All items are sufficiently stocked!</div></div>';
            }

            let tableHtml = `
                <div style="overflow-x: auto; margin-top: 20px;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Item Name</th>
                                <th>Category</th>
                                <th>Current Stock</th>
                                <th>Low Stock Threshold</th>
                                <th>Status</th>
                                <th>Purchase Price</th>
                                <th>Selling Price</th>
                                <th>Supplier</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            lowStockItems.forEach(item => {
                const status = item.quantity === 0 ? 'Out of Stock' : 'Low Stock';
                const statusClass = item.quantity === 0 ? 'badge-danger' : 'badge-warning';

                tableHtml += `
                    <tr>
                        <td>${item.name}</td>
                        <td>${item.category.charAt(0).toUpperCase() + item.category.slice(1)}</td>
                        <td>${item.quantity}</td>
                        <td>${settings.lowStockThreshold}</td>
                        <td><span class="badge ${statusClass}">${status}</span></td>
                        <td><span class="currency">${item.purchasePrice.toLocaleString('en-IN')}</span></td>
                        <td><span class="currency">${item.sellingPrice.toLocaleString('en-IN')}</span></td>
                        <td>${item.supplierName || 'Not specified'}</td>
                    </tr>
                `;
            });

            tableHtml += `
                        </tbody>
                    </table>
                </div>
                <div style="margin-top: 30px; padding: 20px; background: var(--light-gray); border-radius: 10px;">
                    <h4>Summary</h4>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 15px;">
                        <div style="background: white; padding: 15px; border-radius: 10px;">
                            <div style="font-size: 0.9rem; color: var(--gray);">Low Stock Items</div>
                            <div style="font-size: 1.5rem; font-weight: 600; color: var(--warning);">${lowStockItems.filter(item => item.quantity > 0).length}</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 10px;">
                            <div style="font-size: 0.9rem; color: var(--gray);">Out of Stock Items</div>
                            <div style="font-size: 1.5rem; font-weight: 600; color: var(--danger);">${lowStockItems.filter(item => item.quantity === 0).length}</div>
                        </div>
                    </div>
                    <div style="margin-top: 20px;">
                        <button class="btn btn-warning" onclick="showPage('inventory'); document.getElementById('filterStock').value='low'; applyFilters();">
                            <i class="fas fa-boxes"></i>
                            View Low Stock Items in Inventory
                        </button>
                    </div>
                </div>
            `;

            return tableHtml;
        }

        // Download report as PDF
        function downloadReportPDF() {
            const reportType = document.getElementById('reportPreview').getAttribute('data-report-type');
            if (!reportType) {
                showError('Please generate a report first!');
                return;
            }

            const doc = new jsPDF('p', 'pt', 'a4');
            const reportTitle = getReportTitle(reportType);
            const today = new Date().toLocaleDateString('en-IN', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            // Add header
            doc.setFontSize(20);
            doc.text(reportTitle, 40, 40);

            doc.setFontSize(12);
            doc.text(`Shop: ${settings.shopName}`, 40, 70);
            doc.text(`Generated on: ${today}`, 40, 90);

            // Add line separator
            doc.setLineWidth(1);
            doc.line(40, 110, 550, 110);

            let yPosition = 130;

            // Generate report data for PDF
            let tableData = [];
            let tableColumns = [];

            switch (reportType) {
                case 'inventory':
                    tableColumns = ['Item Name', 'Category', 'Purchase Price', 'Selling Price', 'Quantity', 'Stock Status', 'Total Value'];
                    inventory.forEach(item => {
                        const stockStatus = item.quantity === 0 ? 'Out of Stock' : item.quantity <= settings.lowStockThreshold ? 'Low Stock' : 'In Stock';
                        const itemValue = item.purchasePrice * item.quantity;
                        tableData.push([
                            item.name,
                            item.category.charAt(0).toUpperCase() + item.category.slice(1),
                            '₹' + item.purchasePrice.toLocaleString('en-IN'),
                            '₹' + item.sellingPrice.toLocaleString('en-IN'),
                            item.quantity,
                            stockStatus,
                            '₹' + itemValue.toLocaleString('en-IN')
                        ]);
                    });
                    break;

                case 'sales':
                    tableColumns = ['Date', 'Item Name', 'Quantity', 'Unit Price', 'Total Amount', 'Customer', 'Payment Method'];
                    sales.forEach(sale => {
                        const saleDate = new Date(sale.date);
                        const formattedDate = saleDate.toLocaleDateString('en-IN', {
                            day: 'numeric',
                            month: 'short',
                            year: 'numeric'
                        });
                        tableData.push([
                            formattedDate,
                            sale.itemName,
                            sale.quantity,
                            '₹' + sale.unitPrice.toLocaleString('en-IN'),
                            '₹' + sale.totalAmount.toLocaleString('en-IN'),
                            sale.customerName,
                            sale.paymentMethod.charAt(0).toUpperCase() + sale.paymentMethod.slice(1)
                        ]);
                    });
                    break;

                case 'supplier':
                    tableColumns = ['Supplier Name', 'Contact Person', 'Phone', 'Email', 'Items Supplied', 'Last Order'];
                    suppliers.forEach(supplier => {
                        const lastOrder = supplier.lastOrder ? new Date(supplier.lastOrder) : new Date();
                        const formattedDate = lastOrder.toLocaleDateString('en-IN', {
                            day: 'numeric',
                            month: 'short',
                            year: 'numeric'
                        });
                        const itemsText = supplier.items && supplier.items.length > 0 ?
                            supplier.items.map(item => {
                                const categories = {
                                    'electronics': 'Electronics',
                                    'clothing': 'Clothing',
                                    'home': 'Home & Kitchen',
                                    'groceries': 'Groceries',
                                    'beauty': 'Beauty & Health',
                                    'sports': 'Sports & Outdoors',
                                    'other': 'Other'
                                };
                                return categories[item] || item;
                            }).join(', ') : 'Not specified';

                        tableData.push([
                            supplier.name,
                            supplier.contact,
                            supplier.phone,
                            supplier.email || '-',
                            itemsText,
                            formattedDate
                        ]);
                    });
                    break;

                case 'lowstock':
                    const lowStockItems = inventory.filter(item => item.quantity <= settings.lowStockThreshold);
                    tableColumns = ['Item Name', 'Category', 'Current Stock', 'Low Stock Threshold', 'Status', 'Purchase Price', 'Selling Price', 'Supplier'];
                    lowStockItems.forEach(item => {
                        const status = item.quantity === 0 ? 'Out of Stock' : 'Low Stock';
                        tableData.push([
                            item.name,
                            item.category.charAt(0).toUpperCase() + item.category.slice(1),
                            item.quantity,
                            settings.lowStockThreshold,
                            status,
                            '₹' + item.purchasePrice.toLocaleString('en-IN'),
                            '₹' + item.sellingPrice.toLocaleString('en-IN'),
                            item.supplierName || 'Not specified'
                        ]);
                    });
                    break;
            }

            // Add table to PDF
            doc.autoTable({
                head: [tableColumns],
                body: tableData,
                startY: yPosition,
                margin: { left: 40, right: 40 },
                styles: { fontSize: 10 },
                headStyles: { fillColor: [79, 70, 229] }
            });

            // Add summary if needed
            const finalY = doc.lastAutoTable.finalY || yPosition;
            doc.setFontSize(12);
            doc.text(`Total Records: ${tableData.length}`, 40, finalY + 30);

            // Save the PDF
            doc.save(`${reportTitle.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`);

            showNotification('PDF report downloaded successfully!');
        }

        // Get report title by type
        function getReportTitle(type) {
            switch (type) {
                case 'inventory': return 'Inventory Report';
                case 'sales': return 'Sales Report';
                case 'supplier': return 'Supplier Report';
                case 'lowstock': return 'Low Stock Alert Report';
                default: return 'Report';
            }
        }

        // Print report
        function printReport() {
            const reportType = document.getElementById('reportPreview').getAttribute('data-report-type');
            if (!reportType) {
                showError('Please generate a report first!');
                return;
            }

            const printWindow = window.open('', '_blank');
            const reportTitle = getReportTitle(reportType);
            const today = new Date().toLocaleDateString('en-IN', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            printWindow.document.write(`
                <html>
                <head>
                    <title>${reportTitle}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h1 { color: #4f46e5; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #4f46e5; color: white; }
                        .summary { margin-top: 30px; padding: 20px; background-color: #f1f5f9; border-radius: 10px; }
                        .footer { margin-top: 50px; font-size: 12px; color: #666; text-align: center; }
                    </style>
                </head>
                <body>
                    <h1>${reportTitle}</h1>
                    <p><strong>Shop:</strong> ${settings.shopName}</p>
                    <p><strong>Generated on:</strong> ${today}</p>
                    <hr>
            `);

            // Add report content
            const reportContent = document.getElementById('reportPreview').innerHTML;
            printWindow.document.write(reportContent);

            printWindow.document.write(`
                    <div class="footer">
                        <p>Generated by ShopSync Pro Inventory Management System</p>
                    </div>
                </body>
                </html>
            `);

            printWindow.document.close();
            printWindow.focus();
            printWindow.print();
            printWindow.close();
        }

        // Close view modal
        function closeViewModal() {
            document.getElementById('viewItemModal').style.display = 'none';
        }

        // Load user profile
        function loadUserProfile() {
            document.getElementById('userName').textContent = userProfile.name;
            document.getElementById('userAvatar').textContent = userProfile.avatarInitials;
            document.getElementById('profileAvatar').textContent = userProfile.avatarInitials;

            // Populate profile form
            document.getElementById('profileName').value = userProfile.name;
            document.getElementById('profileEmail').value = userProfile.email;
            document.getElementById('profilePhone').value = userProfile.phone;
            document.getElementById('profileShopName').value = userProfile.shopName;
            document.getElementById('profileShopAddress').value = userProfile.shopAddress || '';
            document.getElementById('profileAvatarInitials').value = userProfile.avatarInitials;
        }

        // Open user profile modal
        function openUserProfileModal() {
            document.getElementById('userProfileModal').style.display = 'flex';
        }

        // Close user profile modal
        function closeUserProfileModal() {
            document.getElementById('userProfileModal').style.display = 'none';
        }

        // Save user profile
        function saveUserProfile(e) {
            e.preventDefault();

            userProfile.name = document.getElementById('profileName').value.trim();
            userProfile.email = document.getElementById('profileEmail').value.trim();
            userProfile.phone = document.getElementById('profilePhone').value.trim();
            userProfile.shopName = document.getElementById('profileShopName').value.trim();
            userProfile.shopAddress = document.getElementById('profileShopAddress').value.trim();
            userProfile.avatarInitials = document.getElementById('profileAvatarInitials').value.trim().toUpperCase() || userProfile.avatarInitials;

            saveAllData();
            loadUserProfile();
            closeUserProfileModal();

            showNotification('Profile updated successfully!');
        }

        // Save settings
        function saveSettings() {
            settings.shopName = document.getElementById('shopName').value.trim();
            settings.currency = document.getElementById('currency').value;
            settings.lowStockThreshold = parseInt(document.getElementById('lowStockThreshold').value) || 10;
            settings.taxPercentage = parseFloat(document.getElementById('taxPercentage').value) || 18;
            settings.shopAddress = document.getElementById('shopAddress').value.trim();
            settings.shopPhone = document.getElementById('shopPhone').value.trim();
            settings.shopEmail = document.getElementById('shopEmail').value.trim();

            saveAllData();
            showNotification('Settings saved successfully!');
        }

        // Reset settings
        function resetSettings() {
            if (confirm('Are you sure you want to reset settings to default?')) {
                settings = {
                    shopName: "Rohan's Super Shop",
                    currency: "Indian Rupee (₹)",
                    lowStockThreshold: 10,
                    taxPercentage: 18,
                    shopAddress: "123 Main Street, Mumbai, Maharashtra 400001",
                    shopPhone: "+91 98765 43210",
                    shopEmail: "contact@rohansshop.com"
                };

                saveAllData();
                applySettings();
                showNotification('Settings reset to default!');
            }
        }

        // Confirm clear all data
        function confirmClearData() {
            if (confirm('WARNING: This will delete ALL data including inventory, suppliers, sales, diary entries, and settings. This action cannot be undone! Are you sure?')) {
                if (confirm('LAST CHANCE: Are you absolutely sure you want to delete ALL data?')) {
                    clearAllData();
                }
            }
        }

        // Clear all data
        function clearAllData() {
            inventory = [];
            suppliers = [];
            diaryEntries = [];
            sales = [];
            settings = {
                shopName: "Rohan's Super Shop",
                currency: "Indian Rupee (₹)",
                lowStockThreshold: 10,
                taxPercentage: 18,
                shopAddress: "123 Main Street, Mumbai, Maharashtra 400001",
                shopPhone: "+91 98765 43210",
                shopEmail: "contact@rohansshop.com"
            };

            saveAllData();

            // Update UI
            updateDashboardStats();
            updateInventoryTable();
            updateRecentActivity();
            updateSuppliersTable();
            updateSupplierDropdown();
            updateDiaryEntries();
            updateSalesChart();
            applySettings();

            showNotification('All data cleared successfully!', 'warning');
        }

        // Update shop status
        function updateShopStatus() {
            const isOpen = document.getElementById('shopStatusToggle').checked;
            showNotification(`Shop is now ${isOpen ? 'OPEN' : 'CLOSED'}`, isOpen ? 'success' : 'warning');
        }

        // Load recent activity
        function loadRecentActivity() {
            updateRecentActivity();
            showNotification('Recent activity refreshed!');
        }

        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('successNotification');
            const errorNotification = document.getElementById('errorNotification');

            if (type === 'error') {
                document.getElementById('errorMessage').textContent = message;
                errorNotification.style.display = 'flex';

                // Hide after 5 seconds
                setTimeout(() => {
                    errorNotification.style.display = 'none';
                }, 5000);
            } else {
                document.getElementById('notificationMessage').textContent = message;
                notification.style.display = 'flex';

                // Hide after 3 seconds
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 3000);
            }
        }

        // Show error
        function showError(message) {
            showNotification(message, 'error');
        }
    </script>
</body>


</html>
